From: Markus Koschany <apo@debian.org>
Date: Sun, 9 Sep 2018 18:20:42 +0200
Subject: CVE-2018-16543

Instead of using /GetDeviceParam .special_op wich is not available in this
version, we use /PageSize //.gsgetdeviceprop again. It is merely a slower
implementation. The problematic gssetresolution and gsgetresolution are
removed.

Bug-Debian: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=908303
Origin: http://git.ghostscript.com/?p=ghostpdl.git;a=commit;h=5b5536fa88a9e885032bc0df3852c3439399a5c0
---
 Resource/Init/gs_init.ps  | 27 +++++++++------------------
 Resource/Init/gs_setpd.ps |  2 +-
 2 files changed, 10 insertions(+), 19 deletions(-)

diff --git a/Resource/Init/gs_init.ps b/Resource/Init/gs_init.ps
index 6a4c5e3..0b09017 100644
--- Resource/Init/gs_init.ps
+++ Resource/Init/gs_init.ps
@@ -741,23 +741,6 @@ userdict /.currentresourcefile //null put
   { /run .systemvar exec } .execasresource
 } bind def

-% Define procedures for getting and setting the current device resolution.
-
-/gsgetdeviceprop	% <device> <propname> gsgetdeviceprop <value>
- { 2 copy mark exch //null .dicttomark .getdeviceparams
-   dup mark eq		% if true, not found
-    { pop dup /undefined signalerror }
-    { 5 1 roll pop pop pop pop }
-   ifelse
- } bind def
-/gscurrentresolution	% - gscurrentresolution <[xres yres]>
- { currentdevice /HWResolution gsgetdeviceprop
- } bind def
-/gssetresolution	% <[xres yres]> gssetresolution -
- { 2 array astore mark exch /HWResolution exch
-   currentdevice copydevice putdeviceprops setdevice
- } bind def
-
 % Define auxiliary procedures needed for the above.
 /shellarguments		% -> shell_arguments true (or) false
         { /ARGUMENTS where
@@ -1495,6 +1478,14 @@ setpacking
   dup 150 lt //systemdict /DITHERPPI known not and
 } bind def

+/.gsgetdeviceprop      % <device> <propname> gsgetdeviceprop <value>
+ { 2 copy mark exch //null .dicttomark .getdeviceparams
+   dup mark eq         % if true, not found
+    { pop dup /undefined signalerror }
+    { 5 1 roll pop pop pop pop }
+   ifelse
+ } bind def
+
 % The following implementation uses LL2 extensions, but only in stopped
 % contexts so that with LL1, the .set??reshalftone will be used.
 %
@@ -1502,7 +1493,7 @@ setpacking
 %			      false
 /.getdefaulthalftone {
   % try the device to see if it has a default halftone
-  { currentdevice /HalftoneDefault gsgetdeviceprop } .internalstopped
+  { currentdevice /HalftoneDefault //.gsgetdeviceprop exec } .internalstopped
   { pop pop //false }		% no device property
   { dup type /dicttype eq { //true } { pop //false } ifelse }
   ifelse
diff --git a/Resource/Init/gs_setpd.ps b/Resource/Init/gs_setpd.ps
index bfe8528..2b249e2 100644
--- Resource/Init/gs_setpd.ps
+++ Resource/Init/gs_setpd.ps
@@ -212,7 +212,7 @@ level2dict begin
     mark
     % First put the device's default page size in slot 0
     % This satifies those that have devices built with a4 as the default
-    0 mark /PageSize currentdevice /PageSize gsgetdeviceprop .dicttomark
+    0 mark /PageSize currentdevice /PageSize //.gsgetdeviceprop exec .dicttomark

     statusdict /.pagetypenames get {
       statusdict /.pagetypeprocs get
