Description: CVE-2016-7977: .libfile doesn't check PermitFileReading array, allowing remote file disclosure
Origin: upstream, http://git.ghostscript.com/?p=ghostpdl.git;h=8abd22010eb4db0fb1b10e430d5f5d83e015ef70
Bug: http://bugs.ghostscript.com/show_bug.cgi?id=697169
Bug-Debian: https://bugs.debian.org/839841
Forwarded: not-needed
Author: Chris Liddell <chris.liddell@artifex.com>
Reviewed-by: Salvatore Bonaccorso <carnil@debian.org>
Last-Update: 2016-10-08
---

diff --git a/psi/zfile.c b/psi/zfile.c
index b6caea2..2c6c958 100644
--- psi/zfile.c
+++ psi/zfile.c
@@ -1081,6 +1081,9 @@ lib_file_open(gs_file_path_ptr  lib_path, const gs_memory_t *mem, i_ctx_t *i_ctx
     gs_main_instance *minst = get_minst_from_memory(mem);
     int code;
 
+    if (i_ctx_p && starting_arg_file)
+        i_ctx_p->starting_arg_file = false;
+
     /* when starting arg files (@ files) iodev_default is not yet set */
     if (iodev == 0)
         iodev = (gx_io_device *)gx_io_device_table[0];
-- 
2.9.3

