From: Markus Koschany <apo@debian.org>
Date: Sun, 2 Sep 2018 20:01:59 +0200
Subject: dSAFER sandbox bybass part7

CVE-2018-16509

Bug-Debian: https://bugs.debian.org/907332
Origin: http://git.ghostscript.com/?p=ghostpdl.git;a=commitdiff;h=78911a01
---
 psi/zdevice2.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/psi/zdevice2.c b/psi/zdevice2.c
index f391da1..520a7ab 100644
--- psi/zdevice2.c
+++ psi/zdevice2.c
@@ -311,6 +311,9 @@ z2grestoreall(i_ctx_t *i_ctx_p)
 static int
 z2restore(i_ctx_t *i_ctx_p)
 {
+    os_ptr op = osp;
+    check_type(*op, t_save);
+
     while (gs_state_saved(gs_state_saved(igs))) {
         if (restore_page_device(igs, gs_state_saved(igs)))
             return push_callout(i_ctx_p, "%restore1pagedevice");
